<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <link rel="icon" type="image/x-icon" href="/src/icons/mywallet.svg">
    <link rel="apple-touch-icon" href="/src/icons/mywallet.png">
    <link rel="manifest" href="/manifest.json">
    <title>Inicio</title>
    <!-- iOS: Pantalla completa -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="My Wallet">
    <!-- Agrega el estilo de la aplicación -->
    <link rel="stylesheet" href="/styles/app.css">
    <!-- Agrega Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <!-- Overlay de carga -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Validando sesión...</div>
    </div>

    <div class="app-container" id="appContainer">
        <!-- Header con información del usuario -->
        <header class="header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <h2 id="userName">Usuario</h2>
                    <p id="userEmail">usuario@ejemplo.com</p>
                </div>
            </div>
            <button class="logout-btn" id="logoutBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M17 7L15.59 8.41L18.17 11H8V13H18.17L15.59 15.58L17 17L22 12L17 7ZM4 5H12V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H12V19H4V5Z"
                        fill="currentColor" />
                </svg>
            </button>
        </header>

        <!-- Tarjetas de funciones principales -->
        <section class="features-grid">
            <div class="feature-card wallet" id="invoiceBtn">
                <div class="feature-icon">
                    <i class="fa-solid fa-file-invoice" aria-hidden="true"></i>
                </div>
                <h3>Recibos</h3>
                <p>Genera recibos</p>
            </div>
            <div class="feature-card wallet" id="loansBtn">
                <div class="feature-icon">
                    <i class="fa-solid fa-money-bill-wave" aria-hidden="true"></i>
                </div>
                <h3>Prestamos</h3>
                <p>Prestamos realizados</p>
            </div>
        </section>

        <!-- Barra de navegación inferior -->
        <nav class="bottom-nav">
            <a class="nav-item">
                <span class="nav-icon">
                    <i class="fa-solid fa-house-user"></i>
                </span>
                <span>Inicio</span>
            </a>
            <a class="nav-item active">
                <span class="nav-icon">
                    <i class="fa-solid fa-wallet"></i>
                </span>
                <span>Billetera</span>
            </a>
            <a class="nav-item">
                <span class="nav-icon">
                    <i class="fa-solid fa-key"></i>
                </span>
                <span>Llavero</span>
            </a>
            <a class="nav-item">
                <span class="nav-icon">
                    <i class="fa-solid fa-note-sticky"></i>
                </span>
                <span>Notas</span>
            </a>
        </nav>
    </div>

    <script type="module">
        import { validarSesion, cerrarSesion } from "/js/auth.js";

        const userName = document.getElementById("userName");
        const userEmail = document.getElementById("userEmail");
        const userAvatar = document.getElementById("userAvatar");
        const logoutBtn = document.getElementById("logoutBtn");

        const invoiceBtn = document.getElementById("invoiceBtn");
        const loansBtn = document.getElementById("loansBtn");

        // Constantes de apps
        const app = "/app/{feature}/index.html";
        const appInicio = app.replace("{feature}", "home");
        const appLlavero = app.replace("{feature}", "keys");
        const appNotas = app.replace("{feature}", "notes");
        const appRecibos = app.replace("{feature}", "invoice");
        const appPrestamos = app.replace("{feature}", "loans");

        // Validar sesión y mostrar datos
        validarSesion({
            onUserLogged: (user) => {
                userName.textContent = user.nombre;
                userEmail.textContent = user.email;

                // Iniciales o primera letra
                userAvatar.textContent =
                    user.nombre !== "Usuario"
                        ? user.nombre.split(' ').map(n => n[0]).join('').toUpperCase()
                        : user.email[0].toUpperCase();
            },
            onError: () => { }
        });

        // Logout
        logoutBtn.addEventListener("click", cerrarSesion);

        //Navegación
        invoiceBtn.addEventListener("click", () => window.location.href = appRecibos);
        loansBtn.addEventListener("click", () => window.location.href = appPrestamos);

        // Barra inferior
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');

                const sectionName = this.querySelector('span:last-child').textContent;
                switch (sectionName) {
                    case 'Inicio': window.location.href = appInicio; break;
                    case 'Llavero': window.location.href = appLlavero; break;
                    case 'Notas': window.location.href = appNotas; break;
                }
            });
        });
    </script>
</body>

</html>